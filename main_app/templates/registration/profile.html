{%extends "base.html" %}
{% load static %}
{%block content%}

{%if user.is_authenticated %}

<div class="container">
    <div class="row">
        <div class="card col s12">
            <div class="card-content">
                <div class=" row valign-wrapper">
                    <div class="col">
                        <form id="update-profile-pic" action="{%url 'add-photo' %}" method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}   
                        <label for="input-image">
                            <img src="{{user.profile.url}}" id="output" class="responsive-img circle profile_lg" >  
                        </label>
                        <input id="input-image" class="display_none" type="file" name="input-image" accept="image/x-png,image/gif,image/jpeg"/>
                        </form>  
                        <script>
                            let inputImage = document.getElementById('input-image');
                            inputImage.onchange = function(e){
                                if(e.target.files && e.target.files[0]){
                                    let output = document.getElementById('output');
                                    output.src = URL.createObjectURL(e.target.files[0]);
                                    document.getElementById("update-profile-pic").submit();
                                    output.onload = ()=>{
                                    URL.revokeObjectURL(output.src)
                                }
                                }
                            }
                        </script>
                    </div>
                    <div class="col flow-text">
                        <h1>{{user.username}}</h1>
                    </div>
                </div>
            </div>
            <div class="card-action center">
                <div class="row">
                    <div class="col s4">
                        <a href="javascript:openCollapsible(0);" class="btn white  blue-text"><i class="material-icons">favorite</i></a> 0
                    </div>
                    <div class="col s4">
                        <a href="javascript:openCollapsible(1);" class="btn white blue-text"><i class="material-icons">place</i></a> {{user.spot_set.count}}
                    </div>
                    <div class="col s4">
                        <a href="javascript:openCollapsible(2);" class="btn white blue-text"><i class="material-icons">comment</i></a> {{user.comment_set.count}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
            <ul class="collapsible">
                
                <li>
                    <a name="0"></a>
                  <div class="collapsible-header"><i class="material-icons">favorite</i>Favorites</div>
                  <div class="collapsible-body">
                  </div>
                </li>
                <li>
                    <a name="1"></a>
                  <div class="collapsible-header"><i class="material-icons">place</i>Spots Posted</div>
                  <div class="collapsible-body">
                    {%for spot in user.spot_set.all%}
                    <div class="card-panel">
                        <div class="row">
                            <div class="col s4 m4 l2">
                                <img class="materialboxed circle profile_sm" src="{{spot.url}}">
                            </div>
                            <div class="col s8 m8 l3">
                                Lat:{{spot.lat}} <br/> Lon {{spot.lon}}
                            </div>
                            <div class="col s12 m12 l7">
                                Addr: {{spot.addr}}
                            </div>
                        </div>

                                <blockquote>{{spot.notes}}</blockquote>
                            </div>
                    {%endfor%}
                    </div>
                </li>
                <li>
                    <a name="2"></a>
                  <div class="collapsible-header"><i class="material-icons">comment</i>Comments</div>
                  <div class="collapsible-body">
                    {%for comment in user.comment_set.all%}
                    <div class="card-panel">
                                <img class="responsive-img circle" style="height: 64px; width: 64px" src="{{comment.user.profile.url}}">
                                User: {{comment.user.username}}
                                Address: {{comment.spot.addr}}
                                Comment: {{comment.notes}}
                                <div class="yellow">
                                    {%for i in rating_range%}
                                        {%if i < comment.rating%}
                                            *
                                        {%else%}
                                            -
                                        {%endif %}
                                    {%endfor %}
                                </div>
                            </div>
                    {%endfor%}
                  </div>
                </li>
              </ul>
    </div>
</div>
<div class="fixed-action-btn">
    <a href="#top"class="btn-floating btn-large white">
      <i class="large material-icons black-text">arrow_upward</i>
    </a>
  </div>
<script src="{% static 'javascript/profile.js' %}"></script>
{%endif%}
{%endblock%}

